---
layout: post
title:  "Android网络编程之HTTP协议原理"
date:  2018-4-27 15:39:20
categories: Android
tags: Android

---
* content
{:toc}

## 前言

经历了今年的春招，发现大厂对实习生的基础知识是看得很重的，虽然没有拿到心仪的Offer，但也不能因此放弃学习。

本章的学习笔记内容包括：网络协议、网络知识、Okhttp3、Retrofit。主要是以面试的角度来学习Android在网络这一模块的相关知识点。

## 一、基础概念

### 1.OSI 七层网络模型

OSI 模型将计算机网络体系结构的通信协议划分为七层，每一层都建立在它的下层之上，同时向它的上一层提供一定服务。

- **七层模型**自下而上分别为：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。其中低四层完成数据传输，高三层面向用户。

- **五层模型**分别为：物理层、数据链路层、网络层、传输层、应用层。

### 2.TCP 和 UDP 的区别

- **TCP**：传输控制协议，客户端和服务器传输数据前要建立连接，此连接需要经过三次对话建立，由于建立了连接，提供数据超时重发，丢弃重复数据等数据，因此适合传输大量数据，但传输速度比较慢。

- **UDP**：用户数据协议，不必建立连接，客户端和服务器之间直接将IP层的数据包发送出去，不能保证数据是否成功到达目的地，也没有超时重发等机制，但传输速度很快，适合小数据，可靠要求不高的数据传输。

### 3.TCP/IP三次握手

**SYN**(Synchronous)：是TCP/IP建立连接时使用的握手信号。

**ACK**(Acknowledgement)：确认字符，确认发来的数据已经接受无误。

**Seq**(Sequence)：序列号。

![](https://i.imgur.com/KUTHpix.jpg)

1. 第一次握手：**建立连接**。客户端发送连接请求报文段，将 SYN 设置为1、Seq=J；接下来客户端进入SYN_SENT状态，等待服务器的确认。

2. 第二次握手：**服务器收到客户端的 SYN 报文段**，对SYN报文段进行确认，设置ACK为J+1；同时将 SYN 设置为1，Seq为 K。将 SYN+Seq+ACK放到报文段中，一并发送给客户端，此时服务端进入SYN_RCVD状态。

3. 第三次握手：**完成连接**，客户端收到服务端的SYN+ACK报文段，将 ACK 设置为 K+1 并向服务端发送。客户端和服务端进入 ESTABLISHED 状态，表示 TCP 连接成功。

### 4.什么是HTTP协议

- **协议**：指计算机通信网络中两台计算机之间进行通信所必须共同遵守的规定或规则。
- **HTTP协议**：HyperText Transfer Protocol（超文本传输协议），TCP/IP 协议的一个应用层协议，用于定义 WEB 浏览器与 WEB 服务器之间交换数据的过程。
	- Client->请求->Server
	- Server->响应->Client

### 5.URI 和 URL 的区别

- **URI统一资源标识符**：用来唯一标识一个资源。由以下三个部分组成：
	- 访问资源的命名机制；
	- 存放资源的主机名；
	- 资源自身的名称，由路径表示，着重强调于资源；

	```
	例子：file://a:123/v/c.txt
	```

- **URL统一资源定位器**：它是一种具体的 URI，即 URL 可以用来标识一资源，而还指明了如何定位这个资源。URL 的格式由以下三个部分组成：
	- 协议；(http、https)
	- 存有该资源的主机IP地址；（www.baidu.com）
	- 主机资源的具体地址；（目录、文件）

	```
	例子：https://www.baidu.com/
	```

- **区别**：URL 是具体的 URI，而且定位到 URI 具体的位置。URL 强调的是路径，URI 强调的是资源。

### 6.Request 请求头信息

- **Method**：表示请求方法；
- **Host**：表示服务器主机名和端口号；
- **User-agent**：表示客户端操作系统、浏览器版本；
- **Accept**：表示接收的媒体类型；
- **Referer**：表示从哪个链接跳转过来的；
- **Accept-Encoding**：表示客户端可识别的编码格式；
- **Accept-Language**：表示浏览器可支持的语言；
- **If-None-Match**：表示客户端在请求网络的时候，如果ETag和服务端接收请求生成的ETage相同，服务端返回304状态码，可以直接使用本地缓存文件，从而提升性能。
- **If-Modified-Since**：表示缓存页面最后修改时间，服务器会把这个时间和文件最后修改时间对比，如果一致就返回304状态码。否则会返回200状态码，丢弃旧缓存。


### 7.Request 请求的方式

HTTP请求方法有8种，分别是GET、POST、HEAD、PUT、DELETE、TRACE、CONNECT、OPTIONS，最常用的是GET和POST。

- **GET**：请求获取 Request-URI 所标识的资源
- **POST**：在 Request-URI 所标识的资源后附加新的数据
- **HEAD** 请求获取由 Request-URI 所标识的资源的响应信息报头
- **PUT**：请求服务器**存储**一个资源，并用Request-URI作为其标识
- **DELETE**：请求服务器**删除** Request-URI 所标识的资源
- **TRACE**：请求服务器回送收到的请求信息，主要用于**测试**或诊断
- **CONNECT**：HTTP1.1协议中预留给能够将连接改为管道方式的代理服务器。
- **OPTIONS**：请求查询服务器的性能，或者查询与资源相关的选项


### 8.Response 响应头信息

- **Server**：表示服务器用来处理请求的系统信息，和 User-agent 请求报头是相对应的；
- **Date**：表示生成消息产生的日期和时间；
- **Last-Modified**：表示当前资源最后修改的时间，和 If-Modified-Since 对应的；
- **ETag**：特定版本资源的标识符，通常是消息摘要；
- **Expires**：表示浏览器在指定时间内使用缓存；
- **Cache-Control**：告诉服务端到客户端所有的缓存机制是否可以缓存这个对象，单位是秒；

### 9.Http状态码合集

- 100~199 : 指示信息，收到请求，需要请求者继续执行操作。
- 200：请求成功，请求接收并处理。
- 300~399：重定向，要完成请求必须进行更进一步的操作。
- 400~499：客户端错误。
- 500~599：服务器错误。
- 400：客户端请求有语法错误，服务器无法理解。
- 401：请求未授权，改状态代码需与WWW-Authenticate报头域一起使用
- 403：Forbidden，服务器收到请求，但是拒绝提供服务
- 404：Not Found，请求资源不存在，这个就不用说啦
- 500：Internal Server Error，服务器发生不可预期的错误
- 503：Server Unavailable，服务器当前不能处理客户端请求，一段时间后可能恢复正常

### 10.HTTP协议的主要特点

- **支持 C/S (客户/服务器)模式**。
- **简单快速**：客户向服务器请求服务时，只需传送请求方法好路径，就能获取相应的数据。请求方法有GET、POST和HEAD，由于HTTP服务器规模小，所以通信速度非常快。
- **无连接**：限制每次连接只处理一次请求，服务器处理完请求后，会收到客户的应答，即断开连接。采用这种方式可以节省传输时间。
- **无状态**：指协议对于事务处理没有记忆能力，如果后续处理需要前面的信息，则它必须重传，有可能导致传输量增大。另一方面，在服务器不需要先前信息时它的应答速度就较快。
- **灵活**：HTTP允许传输任意类型的数据对象，传输的类型由Content-Type加以标记。


## 二、HTTP协议容易混淆的知识点

### 11.http1.1和 http1.0 的区别

1. 缓存处理。
1. 带宽优化及网络连接的使用。(http1.0不支持断点，大堆东西丢过来)
1. Host头处理(http1.0一台主机只有一个IP地址)
1. 长连接(http1.1传送多个Http请求不用每次都要创建新的连接)


### 12.http1.1 和 http1.0 存在的问题

1. HTTP1.0 在传输数据时，每次都需要重新建立连接，增加了大量的延迟时间。
1. 两者在传输数据时，所有传输的内容都是明文，客户端和服务端都无法验证对方身份，可以通过https来解决。
1. HTTP1.1在使用时，header里携带内容过大，增加了传输成本。
1. 虽然HTTP1.1支持了keep-alive，来弥补多次创建连接产生的延迟，但同时也会给服务端带来性能压力。

### 13.GET 和 POST 方法的区别

- **提交数据**
	- GET：在请求的URL地址后面以？的形式带上交给服务器，多个数据以&进行分隔。
	- POST：通过数据包的形式上交服务器。
- **提交数据的大小**
	- GET：最多2k容量。
	- POST：传输没有数量限制。
- **取得变量的值**
	- GET：Request.QueryString
	- POST：Request.Form 
- **安全问题**
	- GET：安全性能非常低，效率高，适用于查询。
	- POST：安全性能高，适用于增删改。

### 14. Cookie 和 Session 的区别

- **Cookie**：用户信息识别标记。Cookie就是由服然后客户端每次都向服务器发送请求的时候都会带上这些特殊的信息务器发给客户端的特殊信息，而这行信息以文本文件的方式存放在客户端，目的是用来辨认客户端的信息。

- **Session**：是保存在服务器上的记录用户状态机制，客户端浏览器访问服务器的时候，服务器把客户端信息以某种形式记录在服务器上。

	典型的场景比如购物车，当你点击下单按钮时，由于HTTP协议无状态，所以并不知道是哪个用户操作的，所以服务端要为特定的用户创建了特定的Session，用于标识这个用户，并且跟踪用户，这样才知道购物车里面有几本书。

- 区别1：**存放位置**
	- cookie保存在客户端；
	- session保存在服务器端；
- 区别2：**存取方式**
	- Cookie中只能保存ASCII字符串；
	- Session中可以保存任意类型的数据，甚至Java Bean乃至任何Java类、对象等；
- 区别3：**隐私策略**
	- Cookie存储在客户端，对客户端是可见的，可被客户端窥探、复制、修改；
	- Session存储在服务器上，不存在敏感信息泄露的风险；
- 区别4：**有限期限**
	- Cookie的过期时间可以被设置很长；
	- Session依赖于名为JSESSIONI的Cookie，其过期时间默认为-1，只要关闭了浏览器窗口，该Session就会过期；
- 区别5：**对服务器造成的压力**
	- Session是保存在服务器中的，如果并发访问的用户过多，就会产生非常多的session，耗费大量的内存。(比如百度、谷歌就不适合)
	-  Cookie是保存在客户端的，不占用服务端资源，如果并发很多的情况建议使用Cookie。 


## 三、HTTPS26067585

### 15.HTTPS是什么？ 
https实际就是在TCP与http之间加入了SSL/TLS加密来为上层的安全保驾护航，主要用到对称加密、非对称加密、证书，等技术进行客户端与服务器的数据加密传输，最终达到保证整个通信的安全性。



HTTP并不是一个单独的协议，而是对工作在加密连接(SSL/TLS)上的常规HTTP协议。通过在TCP和HTTP之间加入TLS来加密，并且对数据的完整性保护。

![](https://i.imgur.com/bM3Fr2W.png)

### 16.HTTPS传输速度

- **通信慢**：除了http协议原有的TCP连接、发送请求、响应外，还必须处理SSL/TLS通信，导致通信量增加。
- **SSL必须进行加密**：加密和解密的过程会消耗更多服务端资源。

### 17.TLS/SSL握手

- 密码学原理：
	- 对称加密：加密数据的密钥，跟解密数据用的密钥是一样的。
	- 非对称加密：私有密钥，一方保管。公有密钥，双方保管。
- 数字证书：就是互联网通信中标志通讯各方身份信息的一串数字/文件。
- SSL与TLS握手整个过程
	1. 客户端发起请求；(把支持协议版本号、加密算法、随机数发送到服务器)
	2. 服务器回应；(接收后，把证书、随机数发给客户端)
	3. 客户端验证证书；(发送 加密的随机数、编码改变通知、握手结束通知)
	4. 生产密钥；(解密，告诉客户端 编码改变通知和握手结束通知 已收到)
	5. 客户端发送数据；(对称加密数据传输)
	6. ...


### 18.HTTPS中的加密算法相关

- 密钥：是一种参数，他是在使用密码cipher算法过程中输入的参数。同一个明文在不相同的密钥计算下，尽管在相同的密码算法，会产生不相同的密文。(密钥越长，破解难度越高)
	- 对称：又称为共享密钥加密，对称密钥在加密和解密过程中使用的密钥是相同的，常见的对称加密算法有DES、3DES、AES、RC5、RC6。优点是计算速度快，缺点是密钥需要在通讯的两端共享。
	- 非对称：又称为公开密钥加密。服务端会生成一堆密钥，一个私钥保存在服务端，仅自己知道，另一个是公钥，公钥可以自由发布供任何人使用。 












